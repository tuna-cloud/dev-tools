<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../buefy.min.css">
    <link rel="stylesheet" href="../../all.css">
    <link rel="stylesheet" href="../../materialdesignicons.min.css">
</head>

<body>
<div id="app">
    <nav class="level">
        <!-- Left side -->
        <div class="level-left">
            <div class="level-item">
                <p class="subtitle is-5">
                <div class="control" @click="startOrStop">
                    <b-switch type="is-success" v-model="isStart"></b-switch>
                </div>
                </p>
            </div>
            <div class="level-item">
                <div class="field has-addons">
                    <p class="control">
                        <input class="input" type="text" placeholder="Find a post">
                    </p>
                    <p class="control">
                        <button class="button">
                            Search
                        </button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Right side -->
        <div class="level-right">
            <p class="level-item"><strong>共：{{logRecords.length}}</strong></p>
            <p class="level-item"><a>
                <b-button type="is-danger" icon-right="delete" @click="logRecords = []" size="is-small" class="mr-1"/>
            </a></p>
            <p class="level-item"><a>
                <b-button type="is-success" icon-right="wifi-cog" @click="" size="is-small" class="mr-5"/>
            </a></p>
        </div>
    </nav>
    <b-table
            :data="logRecords"
            :bordered="true"
            :striped="true"
            :narrowed="true"
            hoverable
            focusable
            :loading="false"
            :selected.sync="selectedLog"
            :mobile-cards="false">
        <b-table-column field="time" label="Time" width="40" v-slot="props">
            {{ props.row.time }}
        </b-table-column>
        <b-table-column field="uri" label="URL" v-slot="props">
            {{ props.row.uri }}
        </b-table-column>
        <b-table-column field="protocol" label="Protocol" v-slot="props">
            {{ props.row.protocol }}
        </b-table-column>
        <b-table-column field="method" label="Method" v-slot="props">
            {{ props.row.method }}
        </b-table-column>
        <b-table-column field="status" label="Status" v-slot="props">
            {{ props.row.status }}
        </b-table-column>
        <b-table-column field="consummation" label="Response Time" v-slot="props">
            {{ props.row.consummation }}
        </b-table-column>
        <b-table-column field="host" label="Host" v-slot="props">
            {{ props.row.host }}
        </b-table-column>
        <b-table-column field="bodySize" label="Body Size" v-slot="props">
            {{ props.row.bodySize }}
        </b-table-column>
        <b-table-column field="remoteIp" label="Remote IP" v-slot="props">
            {{ props.row.remoteIp }}
        </b-table-column>

        <template #empty>
            <div class="has-text-centered">No records</div>
        </template>
    </b-table>
</div>

<script src="../../vue.js"></script>
<!-- Full bundle -->
<script src="../../buefy.min.js"></script>
<script src="../../base64.min.js"></script>
<script>
    const app = new Vue({
        el: '#app',
        data() {
            return {
                isEmpty: true,
                logRecords: [],
                selectedLog: null,
                isStart: false
            };
        },
        methods: {
            startOrStop() {
                var obj = {};
                obj.action = "boot";
                obj.data = !this.isStart;
                var data = Base64.encode(JSON.stringify(obj));
                window.parent.emit("抓包工具", data);
            }
        }
    });

    function appendLog(par) {
        var json = Base64.decode(par);
        console.log(json);
        var obj = JSON.parse(json);
        app.logRecords.push(obj);
    }
</script>
</body>
</html>
